<script>
  function openForm() {
    document.getElementById("myForm").style.display = "block";
  }

  function closeForm() {
    document.getElementById("myForm").style.display = "none";
  }
</script>

<div class="uk-card uk-card-default uk-card-hover uk-card-body layout-row" style="display: flex; margin-bottom: 15px; max-width: 80%;">
  <span style="margin-right: auto; width: 80%;">
    <div class="layout-row">
      <% if (r_username != null) { %>
      <p style="margin-right:10px"><%- r_username %></p>
      <% } else { %>
      <p style="margin-right:10px">(ì•Œìˆ˜ì—†ìŒ)</p>
      <% } %>
      <% for( let index = 0; index < 5; index++ ) { %>
      <% if (index < review.rating) { %>
      <p>â˜…</p>
      <% } else { %>
      <p>â˜†</p>
      <% } %>
      <% } %>
    </div>
    <p>ì´ ì‘ì„±ìì˜ í›„ê¸° í‰ê· : <%- rating %></p>
    <% if(tags !== null) { %>
      <% tags.split("").forEach((element, index) => { %>
          <% if(tagsData && tagsData[element]) { %>
              <span class="uk-label" style="margin-right:5px; margin-bottom:5px;"><%= tagsData[element] %></span>
          <% } %>
      <% }) %>
    <% } %>
  

    <% let isMyReview = false; %>
    <% if(review.resident_r_id == r_id) isMyReview = true; %>
    <% let isOpened = false; %>
    <% if(opened != null) { %>
      <% opened.forEach(open => { %>
      <% if(openedReviewData.review_rv_id === review.id) isOpened = true; }); %>
    <% } %>

    <% if(!isOpened && !isMyReview) { %>
    <p class="rv-content blur-content"><%- review.content %></p>
    <% } else { %>
    <p class="rv-content"><%- review.content %></p>
    <% } %>
  </span>

  <span class="layout-column">
    <label style="margin: 10px 0; float: right;"><%= review.created_time %>ì‘ì„±</label>

    <% if(who == 1) { %>
      <% if(!isOpened && !isMyReview) { %>
        <% if(canOpen === 1) { %>
            <form action="/realtor/<%= review.ra_regno %>/opening/<%= review.rv_id %>" method="post"> 
            <input type='submit' class="uk-button uk-button-default" style="margin: 10px 0; float: right;" onclick="return window.confirm('í›„ê¸°ë¥¼ ì—´ëŒí•˜ë©´ 2 ğŸ§» íœ´ì§€ë¥¼ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤. ì—´ëŒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');" value='ì—´ëŒ'>
            </form>
        <% } else { %>
        <form>
          <input type='submit' class="uk-button uk-button-default" style="margin: 10px 0; float: right;" onclick="return window.alert('ğŸ§» íœ´ì§€ê°€ ë¶€ì¡±í•˜ì—¬ ì—´ëŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');" value='ì—´ëŒ'>
        </form>
        <% } %>
      <% } else if(!isMyReview) { %>
        <% let isReported = false; %>
        <% if(report != undefined) { %>
          <% report.forEach(repo => { %>
          <% if(repo.repo_rv_id === review.rv_id) isReported = true; }); %>
        <% } %>
        <% if(!isReported) { %>
        <!-- This is a button toggling the modal -->
        <button class="uk-button uk-button-default uk-margin-small-right" type="button" uk-toggle="target: #modal-example">ì‹ ê³ </button>

        <!-- This is the modal -->
        <div id="modal-example" uk-modal>
          <div class="uk-modal-dialog uk-modal-body">
            <form action=<%= `/realtor/report/${review.rv_id}` %>>
              <h2 class="uk-modal-title">ğŸš¨ë‚˜ìœ í›„ê¸°ì…ë‹ˆê¹Œ?ğŸš¨</h2>
              <label><b>ì‹ ê³  ì‚¬ìœ  ì„ íƒ</b></label>
              <div class="report-radio-container" name="reason">
                <label><input style="margin: 15px;" class="uk-radio" type="radio" required="required" name="reason" value=1>ì‚¬ì¹­/ì‚¬ê¸°</label>
                </br>
                <label><input style="margin: 15px;" class="uk-radio" type="radio" required="required" name="reason" value=2>ìš•ì„¤/ë¹„í•˜</label>
                </br>
                <label><input style="margin: 15px;" class="uk-radio" type="radio" required="required" name="reason" value=3>ë¶€ì ì ˆí•œ ë‚´ìš©</label>
              </div>
              <button class="uk-button uk-button-default uk-modal-close" type="button">ì·¨ì†Œ</button>
              <button class="uk-button uk-button-primary" type="submit">ì‹ ê³ </button>
            </form>
          </div>
        </div>
        <% } else { %>
        <lable style="margin: 10px 0; float: right; text-align: right;">ğŸš”ì‹ ê³  ì™„ë£Œ</lable>
        <% } %>
      <% } %>
    <% } %>
  </span>
</div>